<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WebKurierCore ¬∑ Codex Console</title>

  <style>
    :root{
      --bg:#020617;
      --fg:#e5e7eb;
      --muted:#9ca3af;
      --line:#243047;
      --card:#0b1120;
      --btn:#111827;
      --btn2:#1f2937;
      --ok:#16a34a;
      --bad:#dc2626;
      --accent:#60a5fa;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#111827 0,#020617 55%);
      color:var(--fg);
    }

    .page{
      max-width:980px;
      margin:0 auto;
      padding:16px 12px 30px;
    }

    header{
      display:flex;
      flex-direction:column;
      gap:6px;
      padding:10px 6px 14px;
      border-bottom:1px solid var(--line);
      margin-bottom:14px;
    }

    h1{ margin:0; font-size:18px; }
    .sub{ color:var(--muted); font-size:13px; line-height:1.35; }

    .row{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .card{
      background:linear-gradient(145deg,#020617,#020617 55%,#0b1120);
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px;
      box-shadow:0 14px 32px rgba(0,0,0,.45);
      margin-top:12px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(15,23,42,.95);
      color:var(--fg);
      text-decoration:none;
      cursor:pointer;
      font-size:14px;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ border-color:var(--accent); }

    .pill{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .pill.ok{ color:#86efac; border-color:#16a34a55; }
    .pill.bad{ color:#fca5a5; border-color:#dc262655; }

    label{ display:block; margin:0 0 6px; font-size:12px; color:var(--muted); }
    select, textarea, input{
      width:100%;
      background:#0f172a;
      color:var(--fg);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      font-size:14px;
      outline:none;
    }
    textarea{ min-height:160px; resize:vertical; }

    pre{
      margin:0;
      white-space:pre-wrap;
      word-break:break-word;
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      font-size:12.5px;
      line-height:1.35;
    }

    .grid2{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    @media (min-width:860px){
      .grid2{ grid-template-columns: 1fr 1fr; }
    }

    .hint{ color:var(--muted); font-size:12px; margin-top:8px; }
    .danger{ border-color:#dc2626aa; }
  </style>
</head>

<body>
  <div class="page">

    <header>
      <h1>üß† Codex Console</h1>
      <div class="sub">
        –ü—É–ª—å—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —á–µ—Ä–µ–∑ <code>/api/codex/run</code>. –†–µ–∂–∏–º:
        <b>Plan</b> (–ø–ª–∞–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ‚Üí <b>Run</b> (–≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è).
      </div>

      <div class="row">
        <a class="btn" href="/">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –ø–æ—Ä—Ç–∞–ª</a>
        <a class="btn" href="/admin/terminal.html">‚å®Ô∏è Terminal</a>
        <a class="btn" href="/admin/status.html">‚úÖ Status</a>
        <a class="btn" href="/admin/logs.html">üìú Logs</a>
      </div>
    </header>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div>
          <div class="sub">–°–æ—Å—Ç–æ—è–Ω–∏–µ API</div>
          <div id="apiPill" class="pill">‚Ä¶</div>
        </div>
        <div class="row">
          <button class="btn" id="btnHealth">üîé /health</button>
          <button class="btn" id="btnPing">üèì ping</button>
        </div>
      </div>
      <div class="hint">
        –ï—Å–ª–∏ ping –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: –∑–Ω–∞—á–∏—Ç <code>POST /api/codex/run</code> –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ Node-—Å–µ—Ä–≤–µ—Ä–µ.
      </div>
    </div>

    <div class="card grid2">
      <div>
        <label>Preset (–≥–æ—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞-–∑–∞–¥–∞—á–∞)</label>
        <select id="preset">
          <option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å ‚Äî</option>
          <option value="plan_run_api">TASK: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å /api/codex/run (stub)</option>
          <option value="secure_gate">TASK: Security gate (–±–ª–æ–∫ –æ–ø–∞—Å–Ω–æ–≥–æ)</option>
          <option value="smoke">TASK: Smoke check (health/status/ping)</option>
          <option value="agent_tiles">TASK: –ü–ª–∏—Ç–∫–∏ –∏–∑ agents_map.json</option>
          <option value="terminal_router">TASK: Terminal router commands_map.json</option>
        </select>

        <div class="hint">
          –ù–∞–∂–º–∏ preset ‚Üí —Ç–µ–∫—Å—Ç –ø–æ—è–≤–∏—Ç—Å—è —Å–Ω–∏–∑—É. –ü–æ—Ç–æ–º –≤—ã–±–µ—Ä–∏ Plan/Run –∏ ‚Äú–û—Ç–ø—Ä–∞–≤–∏—Ç—å‚Äù.
        </div>
      </div>

      <div>
        <label>–†–µ–∂–∏–º</label>
        <select id="mode">
          <option value="plan">Plan (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)</option>
          <option value="run">Run (–≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è)</option>
        </select>

        <div class="hint">
          –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –≤—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ <b>Plan</b>, –ø–æ—Ç–æ–º <b>Run</b>.
        </div>
      </div>
    </div>

    <div class="card">
      <label>–¢–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏</label>
      <textarea id="taskText" placeholder="–û–ø–∏—à–∏ –∑–∞–¥–∞—á—É. –ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ–±–∞–≤—å endpoint POST /api/codex/run –∏ –≤–µ—Ä–Ω–∏ ok/output_text..."></textarea>

      <div class="row" style="margin-top:10px;">
        <button class="btn" id="btnSend">‚ñ∂Ô∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button class="btn" id="btnCopy">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="btn" id="btnSave">üíæ –í –∏—Å—Ç–æ—Ä–∏—é</button>
        <button class="btn danger" id="btnClear">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>

      <div class="hint">
        ‚Äú–ò—Å—Ç–æ—Ä–∏—è‚Äù —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (localStorage). –≠—Ç–æ —É–¥–æ–±–Ω–æ, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –ø—Ä–æ–º–ø—Ç—ã.
      </div>
    </div>

    <div class="card">
      <label>–û—Ç–≤–µ—Ç / –†–µ–∑—É–ª—å—Ç–∞—Ç</label>
      <pre id="output">‚Äî</pre>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div>
          <label>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–¥–∞—á</label>
          <div class="hint">–ö–Ω–æ–ø–∫–∞ ‚Äú–í—Å—Ç–∞–≤–∏—Ç—å‚Äù –≤–µ—Ä–Ω—ë—Ç –∑–∞–¥–∞—á—É –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø–æ–ª–µ.</div>
        </div>
        <button class="btn danger" id="btnHistoryClear">üóë –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
      </div>
      <div id="history"></div>
    </div>

  </div>

  <!-- ‚úÖ shared logic first (no duplication, no mount) -->
  <script src="/admin/codex-ui.js"></script>

  <!-- ‚úÖ init (binds buttons + presets + history + chunking) -->
  <script src="/admin/codex.js"></script>
</body>
</html>