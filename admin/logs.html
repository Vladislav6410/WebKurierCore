<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>WebKurier ‚Ä¢ –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      margin: 0;
      padding: 16px 16px 24px;
      font-family: "Courier New", monospace;
      background: #0d0d0f;
      color: #e5e5e5;
    }
    header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    .nav-links a {
      color: #9ca3af;
      text-decoration: none;
      font-size: 0.9rem;
      margin-right: 10px;
    }
    .nav-links a:hover {
      color: #ffffff;
      text-decoration: underline;
    }
    h1 {
      text-align: center;
      margin: 10px 0 18px;
      font-size: 1.6rem;
    }

    .controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    select, button {
      padding: 8px 14px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #444;
      background: #1b1b20;
      color: #fff;
    }

    button {
      cursor: pointer;
      background: #3030ff;
      border-color: #2222cc;
    }

    button:hover {
      background: #3f3fff;
    }

    #logs-container {
      margin-top: 10px;
      border: 1px solid #333;
      padding: 12px;
      border-radius: 8px;
      background: #111;
      max-height: 70vh;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 14px;
    }

    .log-entry {
      padding: 6px 0;
      border-bottom: 1px dashed #333;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-info { color: #7cd1ff; }
    .log-warning { color: #ffe37c; }
    .log-error { color: #ff7c7c; }
    .log-debug { color: #9e9e9e; }

    .footer {
      margin-top: 12px;
      text-align: center;
      font-size: 0.85rem;
      opacity: 0.6;
    }
  </style>
</head>

<body>

<header>
  <div class="nav-links">
    <a href="../index.html">‚Üê –ü–æ—Ä—Ç–∞–ª WebKurierCore</a>
    <a href="panel.html">‚Üê –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
  </div>
</header>

<h1>üìú –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã WebKurier</h1>

<div class="controls">
  <select id="source">
    <option value="all">–ò—Å—Ç–æ—á–Ω–∏–∫: –í—Å–µ</option>
    <option value="core">Core</option>
    <option value="drone">Drone</option>
    <option value="security">Security</option>
    <option value="hybrid">Hybrid</option>
  </select>

  <select id="level">
    <option value="info">–£—Ä–æ–≤–µ–Ω—å: INFO</option>
    <option value="warning">WARNING</option>
    <option value="error">ERROR</option>
    <option value="debug">DEBUG</option>
  </select>

  <select id="limit">
    <option value="50">50 –∑–∞–ø–∏—Å–µ–π</option>
    <option value="100" selected>100 –∑–∞–ø–∏—Å–µ–π</option>
    <option value="200">200 –∑–∞–ø–∏—Å–µ–π</option>
    <option value="500">500 –∑–∞–ø–∏—Å–µ–π</option>
  </select>

  <button type="button" onclick="loadLogs()">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
</div>

<div id="logs-container">–ù–∞–∂–º–∏—Ç–µ ‚Äú–ó–∞–≥—Ä—É–∑–∏—Ç—å‚Äù –∏–ª–∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ‚Ä¶</div>

<script>
  // TODO: –ø–æ–¥—Å—Ç–∞–≤—å —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  const ADMIN_TOKEN = "CHANGE_ME_ADMIN_TOKEN";

  async function loadLogs() {
    const source = document.getElementById("source").value;
    const level  = document.getElementById("level").value;
    const limit  = document.getElementById("limit").value;

    const url = `/api/admin/logs?source=${encodeURIComponent(source)}&level=${encodeURIComponent(level)}&limit=${encodeURIComponent(limit)}`;

    const box = document.getElementById("logs-container");
    box.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...";

    try {
      const res = await fetch(url, {
        headers: {
          "Authorization": "Bearer " + ADMIN_TOKEN
        }
      });

      const data = await res.json();

      if (!data.ok) {
        box.textContent = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤: " + (data.error || "unknown");
        return;
      }

      box.innerHTML = "";
      if (!data.entries || data.entries.length === 0) {
        box.textContent = "–õ–æ–≥–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.";
        return;
      }

      data.entries.forEach(entry => {
        const el = document.createElement("div");
        el.classList.add("log-entry");

        let lvlClass = "log-info";
        if (entry.level === "warning") lvlClass = "log-warning";
        if (entry.level === "error") lvlClass = "log-error";
        if (entry.level === "debug") lvlClass = "log-debug";

        const ts = entry.timestamp || "";
        const src = entry.source || "sys";
        const msg = entry.message || "";

        el.innerHTML =
          `[${ts}] <span class="${lvlClass}">${(entry.level || "").toUpperCase()}</span> `
          + `[${src}] ‚Äî ${msg}`;

        box.appendChild(el);
      });

    } catch (err) {
      box.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ / API: " + err;
    }
  }

  // –∞–≤—Ç–æ-–∑–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  window.addEventListener("load", () => {
    loadLogs();
  });
</script>

<div class="footer">
  Admin Logs ‚Ä¢ –¢–æ–ª—å–∫–æ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
</div>

</body>
</html>