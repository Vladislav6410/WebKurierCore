<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>WebKurier ‚Ä¢ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    padding: 20px;
    background: #0d0f14;
    color: #e5e5e5;
    font-family: system-ui, sans-serif;
  }
  header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
  }
  .nav-links a {
    color: #9ca3af;
    text-decoration: none;
    font-size: 0.9rem;
    margin-right: 10px;
  }
  .nav-links a:hover {
    color: #ffffff;
    text-decoration: underline;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    font-size: 1.8rem;
  }

  .status-box {
    background: #11151b;
    border: 1px solid #242933;
    border-radius: 10px;
    padding: 16px;
    margin-bottom: 16px;
  }

  .item {
    padding: 10px 6px;
    border-bottom: 1px solid #222;
  }
  .item:last-child {
    border-bottom: none;
  }

  .ok    { color: #7cff7c; }
  .warn  { color: #ffd86b; }
  .fail  { color: #ff6b6b; }

  .title {
    font-size: 1.2rem;
    margin-bottom: 6px;
    font-weight: 600;
  }
  .footer {
    margin-top: 16px;
    text-align: center;
    opacity: 0.6;
    font-size: 0.85rem;
  }
  .loading {
    opacity: 0.6;
    font-size: 0.95rem;
  }
</style>
</head>

<body>

<header>
  <div class="nav-links">
    <a href="../index.html">‚Üê –ü–æ—Ä—Ç–∞–ª WebKurierCore</a>
    <a href="panel.html">‚Üê –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
  </div>
</header>

<h1>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã WebKurier</h1>

<div id="status-container" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—É—Å–∞‚Ä¶</div>

<script>
  // –í—Å—Ç–∞–≤–∏—à—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
  const ADMIN_TOKEN = "CHANGE_ME_ADMIN_TOKEN";

  async function loadStatus() {
    const box = document.getElementById("status-container");
    box.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶";

    try {
      const res = await fetch("/api/admin/status", {
        headers: {
          "Authorization": "Bearer " + ADMIN_TOKEN
        }
      });

      const data = await res.json();

      if (!data.ok) {
        box.innerHTML = "<span class='fail'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã</span>";
        return;
      }

      // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML
      let html = "";

      // –°–µ—Ä–≤–µ—Ä
      html += `
        <div class="status-box">
          <div class="title">‚öôÔ∏è –°–µ—Ä–≤–µ—Ä</div>
          <div class="item">–í—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞: <b>${data.server_time || "?"}</b></div>
          <div class="item">Backend API: <b class="${data.api_alive ? "ok" : "fail"}">
            ${data.api_alive ? "—Ä–∞–±–æ—Ç–∞–µ—Ç" : "–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"}
          </b></div>
        </div>
      `;

      // –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
      if (data.repos) {
        html += `
          <div class="status-box">
            <div class="title">üìÇ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</div>
        `;
        data.repos.forEach(repo => {
          html += `
            <div class="item">
              <b>${repo.name}</b> ‚Äî 
              <span class="${repo.status === "ok" ? "ok" : "fail"}">${repo.status}</span>
              <br><span style="opacity:0.7">–≤–µ—Ä—Å–∏—è: ${repo.version}</span>
            </div>
          `;
        });
        html += `</div>`;
      }

      // –ê–≥–µ–Ω—Ç—ã
      if (data.agents) {
        html += `
          <div class="status-box">
            <div class="title">ü§ñ –ê–≥–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã</div>
        `;
        data.agents.forEach(agent => {
          html += `
            <div class="item">
              <b>${agent.name}</b> ‚Äî 
              <span class="${agent.ok ? "ok" : "fail"}">
                ${agent.ok ? "–∞–∫—Ç–∏–≤–µ–Ω" : "–æ—à–∏–±–∫–∞"}
              </span>
            </div>
          `;
        });
        html += `</div>`;
      }

      // Docker
      if (data.docker) {
        html += `
          <div class="status-box">
            <div class="title">üê≥ Docker</div>
        `;

        data.docker.forEach(c => {
          html += `
            <div class="item">
              <b>${c.name}</b>: 
              <span class="${c.running ? "ok" : "fail"}">${c.running ? "running" : "stopped"}</span>
            </div>
          `;
        });

        html += `</div>`;
      }

      box.innerHTML = html;

    } catch (err) {
      box.innerHTML = "<span class='fail'>–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å backend</span><br>" + err;
    }
  }

  window.addEventListener("load", loadStatus);
</script>

<div class="footer">Status Monitor ‚Ä¢ –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Ä¢ WebKurierCore ¬© 2025</div>

</body>
</html>