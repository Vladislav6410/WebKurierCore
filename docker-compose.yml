version: "3.9"

services:
  webkurier:
    build: .
    container_name: webkurier
    restart: always

    # Ð¤Ð°Ð¹Ð» Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ ÑÑ€ÐµÐ´Ñ‹)
    env_file:
      - .env

    # ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð°Ð¿Ð¾Ðº Ðº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñƒ
    volumes:
      - ./engine/config:/app/engine/config:ro       # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ)
      - ./engine/memory:/app/engine/memory          # ÐŸÐ°Ð¼ÑÑ‚ÑŒ / Ð´Ð°Ð½Ð½Ñ‹Ðµ
      - ./engine/logs:/app/engine/logs              # Ð›Ð¾Ð³Ð¸ Ð¸ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ°
      - ./engine/agents:/app/engine/agents:ro       # ÐÐ³ÐµÐ½Ñ‚Ñ‹ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ)

    # ðŸ”Œ ÐŸÐ¾Ñ€Ñ‚Ñ‹: 
    # Ð»ÐµÐ²Ð°Ñ Ñ‡Ð°ÑÑ‚ÑŒ (HOST_HTTP_PORT) â€” Ð¿Ð¾Ñ€Ñ‚ Ð½Ð° Ñ…Ð¾ÑÑ‚Ðµ (Ñ‚Ð²Ð¾Ð¹ ÐºÐ¾Ð¼Ð¿ÑŒÑŽÑ‚ÐµÑ€ Ð¸Ð»Ð¸ ÑÐµÑ€Ð²ÐµÑ€)
    # Ð¿Ñ€Ð°Ð²Ð°Ñ Ñ‡Ð°ÑÑ‚ÑŒ (8080) â€” Ð¿Ð¾Ñ€Ñ‚ Ð²Ð½ÑƒÑ‚Ñ€Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°, Ð³Ð´Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ FastAPI
    # ÐµÑÐ»Ð¸ .env Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 8080
    ports:
      - "${HOST_HTTP_PORT:-8080}:8080"

    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ñ†ÐµÑÑ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½
    healthcheck:
      test: ["CMD", "bash", "-c", "pgrep -f startup_loader.py >/dev/null"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s
