<!-- programmer-core.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üíª –ê–≥–µ–Ω—Ç: –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç</title>

  <!-- –í–ê–ñ–ù–û: –º—ã –≤ –ø–∞–ø–∫–µ /ui, –ø–æ—ç—Ç–æ–º—É –ø–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ -->
  <script type="module" src="../programmer-agent.js"></script>

  <style>
    :root{
      --bg:#0b0f14; --panel:#101826; --line:#1f2b3a; --text:#e8eef6; --muted:#9fb0c2;
      --btn:#162233; --btnDanger:#2a1a1a;
    }
    body{
      margin:0; padding:16px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:var(--bg); color:var(--text);
    }
    h1{margin:0 0 10px 0; font-size:20px}
    .hint{color:var(--muted); font-size:12px; margin: 6px 0 12px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:10px 0;}
    button{
      border:1px solid #24344a;
      background:var(--btn);
      color:var(--text);
      padding:8px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
    }
    button.danger{background:var(--btnDanger); border-color:#5a2b2b; color:#ffd6d6;}
    textarea{
      width:100%;
      min-height:90px;
      background:var(--panel);
      color:var(--text);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px;
      resize:vertical;
      outline:none;
    }
    #output{
      margin-top:14px;
      background:var(--panel);
      border:1px solid var(--line);
      padding:12px;
      border-radius:12px;
      white-space:pre-wrap;
      min-height:180px;
    }
    .pill{
      display:inline-block;
      border:1px solid var(--line);
      padding:4px 8px; border-radius:999px;
      color:var(--muted); font-size:12px;
    }
  </style>
</head>

<body>
  <h1>üíª –ê–≥–µ–Ω—Ç-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç <span class="pill">WebPanel</span></h1>

  <div class="hint">
    –¢–µ—Ä–º–∏–Ω–∞–ª-–∫–æ–º–∞–Ω–¥—ã: <b>/programmer</b>, <b>/programmer open &lt;file&gt;</b>, <b>/programmer diff</b>, <b>/programmer apply</b>, <b>/programmer run</b>
  </div>

  <div class="row">
    <button id="btnGen">üß† –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    <button id="btnFix">üõ† –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button id="btnDiff">üßæ Diff</button>
    <button id="btnApply">‚úÖ Apply (WDA)</button>
    <button id="btnRun">‚ñ∂Ô∏è Run</button>
    <button id="btnClear" class="danger">üßπ Clear</button>
  </div>

  <div class="hint">–ó–∞–¥–∞—á–∞/–æ–ø–∏—Å–∞–Ω–∏–µ:</div>
  <textarea id="prompt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–ò—Å–ø—Ä–∞–≤—å terminal.js, –¥–æ–±–∞–≤—å –∫–Ω–æ–ø–∫—É, —Å–¥–µ–ª–∞–π API /api/programmer/apply_patch...'"></textarea>

  <div id="output">–ì–æ—Ç–æ–≤ ‚úÖ</div>

  <script>
    const out = document.getElementById("output");
    const promptEl = document.getElementById("prompt");

    function log(text){
      out.textContent = text;
    }

    // UI hook: ProgrammerAgent –ø–∏—à–µ—Ç —Å—é–¥–∞
    window.__WK_PROGRAMMER_PRINT__ = (text) => log(text);

    function ensureAgent(){
      if (!window.ProgrammerAgent) {
        log("‚ùå window.ProgrammerAgent –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å: ui/programmer-core.html -> src=\"../programmer-agent.js\"");
        return false;
      }
      return true;
    }

    document.getElementById("btnGen").onclick = async () => {
      if (!ensureAgent()) return;
      log("‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é...");
      await window.ProgrammerAgent.generateCode(promptEl.value);
    };

    document.getElementById("btnFix").onclick = async () => {
      if (!ensureAgent()) return;
      log("‚è≥ –ü—Ä–æ–≤–µ—Ä—è—é...");
      await window.ProgrammerAgent.fixBugs(promptEl.value);
    };

    document.getElementById("btnDiff").onclick = async () => {
      if (!ensureAgent()) return;
      log("‚è≥ Diff...");
      await window.ProgrammerAgent.showDiff?.();
    };

    document.getElementById("btnApply").onclick = async () => {
      if (!ensureAgent()) return;
      log("‚è≥ Apply —á–µ—Ä–µ–∑ WDA...");
      // –≠—Ç–æ —Ç–≤–æ—è –∫–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–µ—Ä–≥–∞–µ—Ç window.__WK_PROGRAMMER_APPLY_PATCH__ –∏–∑ programmer-ui.js
      await window.ProgrammerAgent.applyPatchWDA?.();
    };

    document.getElementById("btnRun").onclick = async () => {
      if (!ensureAgent()) return;
      log("‚è≥ Run...");
      await window.ProgrammerAgent.runSandbox?.();
    };

    document.getElementById("btnClear").onclick = () => {
      promptEl.value = "";
      log("üßπ –û—á–∏—â–µ–Ω–æ.");
    };
  </script>
</body>
</html>