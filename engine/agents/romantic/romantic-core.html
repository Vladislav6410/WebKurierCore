<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Romantic Companion ¬∑ WebKurier</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>

  <!-- –û–±—â–∏–π —Å—Ç–∏–ª—å Romantic Agent (–≥—Ä–∞–¥–∏–µ–Ω—Ç, RTL, –º–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è) -->
  <link rel="stylesheet" href="./romantic-style.css"/>

  <!-- i18n (–∑–∞–≥—Ä—É–∑–∫–∞ ./lang/<code>.json, dir=rtl, —Å–æ–±—ã—Ç–∏–µ languageChanged) -->
  <script src="./lang/lang-i18n.js" defer></script>

  <!-- –¢–≤–æ—è –ª–æ–≥–∏–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ romantic-ui.js, –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–∞—Ç—Å—è —Ç—É—Ç) -->
  <script src="./romantic-ui.js" defer></script>

  <style>
    /* –ù–µ–±–æ–ª—å—à–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–≤–∏–∑—É–∞–ª—å–Ω–æ –±–ª–∏–∂–µ –∫ —Ç–≤–æ–µ–º—É –æ—Ä–∏–≥–∏–Ω–∞–ª—É) */
    .card{
      max-width: 880px;
      margin: 72px auto 24px;
      padding: 20px;
      background: rgba(17, 22, 29, 0.9);
      border: 1px solid #2a3140;
      border-radius: 12px;
      backdrop-filter: blur(6px);
    }
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,select,button,textarea{
      border-radius: 8px;
      border: 1px solid #2a3140;
      background: #0f121a;
      color: #e6e6e6;
      padding: 10px;
    }
    textarea{width:100%;min-height:120px;resize:vertical}
    .out{white-space:pre-wrap;margin-top:12px}
    .topbar{
      position:fixed;top:0;left:0;right:0;z-index:10;
      display:flex;justify-content:space-between;align-items:center;
      padding:10px 16px;background:rgba(0,0,0,0.25);backdrop-filter:blur(8px)
    }
    .icon-btn{background:none;border:none;font-size:18px;cursor:pointer}
    .icon-left{color:#9cd4ff}.icon-right{color:#ff9dcc}
    .hint{opacity:.65;font-size:12px}
  </style>
</head>
<body data-theme="dark">
  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å: RTL/Theme -->
  <div class="topbar">
    <button id="toggleRTL" class="icon-btn icon-left" title="RTL">‚ÜîÔ∏è</button>
    <strong>üíû Romantic Companion</strong>
    <button id="toggleTheme" class="icon-btn icon-right" title="Theme">üåô</button>
  </div>

  <div class="card">
    <h1 id="title" data-i18n="app.title">üíû Romantic Companion</h1>

    <div class="row" style="margin-top:4px">
      <label for="mode" class="hint">Mode</label>
      <select id="mode" aria-label="Mode select">
        <option value="chat">Chat</option>
        <option value="poetry">Poetry</option>
        <option value="date-planner">Date planner</option>
        <option value="soothing">Soothing</option>
        <option value="letters">Letters</option>
      </select>
      <!-- —Ç—É—Ç –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ (–∫–Ω–æ–ø–∫–∏/—Å–µ–ª–µ–∫—Ç) -->
      <!-- <iframe src="./lang-menu.html" style="border:none;height:56px;flex:1"></iframe> -->
    </div>

    <textarea id="input" placeholder="Tell me what's on your heart..." aria-label="Message"></textarea>

    <div class="row" style="margin-top:8px">
      <button id="sendBtn" data-i18n="buttons.send" aria-label="Send">Send</button>
      <button id="clearBtn" aria-label="Clear">Clear</button>
      <span class="hint">Enter / ‚åò+Enter ‚Äî send ‚Ä¢ Esc ‚Äî clear</span>
    </div>

    <div id="out" class="out" aria-live="polite"></div>
  </div>

  <script>
    // --- DOM
    const modeEl   = document.getElementById('mode');
    const inputEl  = document.getElementById('input');
    const outEl    = document.getElementById('out');
    const sendBtn  = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');

    // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ
    const MODE_KEY = 'ra_mode';
    const savedMode = localStorage.getItem(MODE_KEY);
    if (savedMode) modeEl.value = savedMode;

    // --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ
    function addOut(text){
      const block = document.createElement('div');
      block.textContent = text;
      outEl.appendChild(block);
    }

    function clearOut(){
      outEl.innerHTML = '';
    }

    async function handleSend(){
      const text = (inputEl.value || '').trim();
      if (!text) return;

      const mode = modeEl.value;
      localStorage.setItem(MODE_KEY, mode);

      addOut('üëâ ' + text);
      inputEl.value = '';

      // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—å –≤ —Ç–≤–æ–π romantic-ui.js —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –∫ –∞–≥–µ–Ω—Ç—É
      // –ù–∏–∂–µ ‚Äî –º–æ–∫-–æ—Ç–≤–µ—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
      const replies = {
        'chat': "üíñ I'm here, listening. Your feelings matter to me.",
        'poetry': "üå∏ In gentle words your heart unfolds ‚Äî I'll keep them safe.",
        'date-planner': "üóìÔ∏è Let's plan a warm evening: cozy cafe, slow walk, soft talk.",
        'soothing': "‚ú® Breathe... you're safe here. I'm with you.",
        'letters': "üíå I'll help you write a letter that carries your warmth."
      };
      // —ç–º—É–ª—è—Ü–∏—è –∑–∞–¥–µ—Ä–∂–∫–∏ ¬´–æ—Ç–≤–µ—Ç–∞¬ª
      setTimeout(()=> addOut('üíû ' + (replies[mode] || replies.chat)), 600);
    }

    // --- –°–æ–±—ã—Ç–∏—è
    sendBtn.addEventListener('click', handleSend);
    clearBtn.addEventListener('click', clearOut);

    inputEl.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) { e.preventDefault(); handleSend(); }
      else if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
      else if (e.key === 'Escape') { clearOut(); }
    });

    // --- –¢–µ–º–∞
    const toggleTheme = document.getElementById('toggleTheme');
    toggleTheme.addEventListener('click', ()=>{
      const next = (document.body.dataset.theme === 'light') ? 'dark' : 'light';
      document.body.dataset.theme = next;
      toggleTheme.textContent = next === 'light' ? '‚òÄÔ∏è' : 'üåô';
    });

    // --- RTL
    const toggleRTL = document.getElementById('toggleRTL');
    toggleRTL.addEventListener('click', ()=>{
      const html = document.documentElement;
      html.dir = (html.dir === 'rtl') ? 'ltr' : 'rtl';
    });

    // --- i18n: –µ—Å–ª–∏ –ø–æ–¥–∫–ª—é—á—ë–Ω lang-i18n.js, –æ–Ω –ø–µ—Ä–µ–≤–µ–¥—ë—Ç —ç–ª–µ–º–µ–Ω—Ç—ã —Å data-i18n (title, –∫–Ω–æ–ø–∫–∏)
    window.addEventListener('languageChanged', ()=>{
      // –ü—Ä–∏ —Å–º–µ–Ω–µ —è–∑—ã–∫–∞ –º–æ–∂–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å placeholder:
      inputEl.setAttribute('placeholder', inputEl.getAttribute('placeholder') || "Tell me what's on your heart...");
      // –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—à—å –∫–ª—é—á–∏ –¥–ª—è mode.* –≤ JSON ‚Äî —Ç—É—Ç –∂–µ –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å option'—ã
    });
  </script>
</body>
</html>