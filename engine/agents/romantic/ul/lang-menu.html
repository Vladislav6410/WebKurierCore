<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Language Menu Â· RomanticAgent</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{ --card:#11151a; --fg:#e9eef4; --muted:#aab7c4; --border:#263241; --accent:#5fb0ff; }
    body{ margin:0; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0f14; color:var(--fg); }
    .wrap{ max-width:840px; margin:24px auto; padding:16px; }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px; }
    .row{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .lang-btn{
      display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border:1px solid var(--border);
      background:#0f141a; color:var(--fg); border-radius:10px; cursor:pointer; user-select:none;
      transition:transform .05s ease, border-color .15s ease;
    }
    .lang-btn:hover{ border-color:var(--accent); }
    .lang-btn.active{ outline:2px solid var(--accent); }
    .flag{ font-size:18px; }
    .code{ color:var(--muted); font-size:12px; letter-spacing:.3px; }
    .spacer{ height:10px; }
    .select{ width:100%; padding:10px; border-radius:10px; border:1px solid var(--border); background:#0f141a; color:var(--fg); }
    .note{ color:var(--muted); font-size:12px; }
    .grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); gap:10px; }
    /* demo area for i18n */
    .demo{ margin-top:16px; padding:12px; border:1px dashed var(--border); border-radius:10px; }
    [dir="rtl"] .row{ flex-direction: row-reverse; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 8px" data-i18n="menu.language">Language</h2>
      <p class="note" data-i18n="labels.language_select">Select Language</p>

      <!-- Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚: ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ñ Ñ„Ð»Ð°Ð³Ð°Ð¼Ð¸ -->
      <div id="langButtons" class="row"></div>

      <div class="spacer"></div>

      <!-- Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚: Ð²Ñ‹Ð¿Ð°Ð´Ð°ÑŽÑ‰Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº (Ð½Ð° ÑÐ»ÑƒÑ‡Ð°Ð¹ Ð¼Ð°Ð»ÐµÐ½ÑŒÐºÐ¾Ð³Ð¾ ÑÐºÑ€Ð°Ð½Ð°) -->
      <select id="langSelect" class="select" aria-label="Language select"></select>

      <div class="demo">
        <strong data-i18n="app.title">Romantic Agent</strong><br/>
        <span data-i18n="app.tagline">An AI companion that understands your heart</span>
        <hr/>
        <button class="lang-btn" disabled>
          <span class="flag">ðŸ’¬</span>
          <span data-i18n="buttons.send">Send</span>
        </button>
        <span class="code" id="rtlInfo">dir: ltr</span>
      </div>
    </div>
  </div>

  <script>
    // â€”â€”â€” ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ ÑÐ·Ñ‹ÐºÐ¾Ð² (ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ñ„Ð°Ð¹Ð»Ð°Ð¼ ./lang/*.json)
    const LANGS = [
      { code:'jp', flag:'ðŸ‡¯ðŸ‡µ', name:'æ—¥æœ¬èªž' },
      { code:'kr', flag:'ðŸ‡°ðŸ‡·', name:'í•œêµ­ì–´' },
      { code:'en', flag:'ðŸ‡ºðŸ‡¸', name:'English' },
      { code:'de', flag:'ðŸ‡©ðŸ‡ª', name:'Deutsch' },
      { code:'pl', flag:'ðŸ‡µðŸ‡±', name:'Polski' },
      { code:'hi', flag:'ðŸ‡®ðŸ‡³', name:'à¤¹à¤¿à¤¨à¥à¤¦à¥€' },
      { code:'tr', flag:'ðŸ‡¹ðŸ‡·', name:'TÃ¼rkÃ§e' },
      { code:'ar', flag:'ðŸ‡¸ðŸ‡¦', name:'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' },
      { code:'pt', flag:'ðŸ‡§ðŸ‡·', name:'PortuguÃªs' },
      { code:'es', flag:'ðŸ‡ªðŸ‡¸', name:'EspaÃ±ol' },
      { code:'ru', flag:'ðŸ‡·ðŸ‡º', name:'Ð ÑƒÑÑÐºÐ¸Ð¹' } // Ð°Ð´Ð¼Ð¸Ð½/Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
    ];

    const DEFAULT_CODE = localStorage.getItem('ra_lang') || 'ru';

    const els = {
      buttons: document.getElementById('langButtons'),
      select: document.getElementById('langSelect'),
      rtlInfo: document.getElementById('rtlInfo')
    };

    // Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ UI
    function buildUI(){
      // ÐºÐ½Ð¾Ð¿ÐºÐ¸
      els.buttons.innerHTML = '';
      LANGS.forEach(l => {
        const b = document.createElement('button');
        b.className = 'lang-btn';
        b.dataset.code = l.code;
        b.innerHTML = `<span class="flag">${l.flag}</span><span>${l.name}</span><span class="code">(${l.code})</span>`;
        b.addEventListener('click', () => setLanguage(l.code));
        els.buttons.appendChild(b);
      });

      // ÑÐµÐ»ÐµÐºÑ‚
      els.select.innerHTML = LANGS
        .map(l => `<option value="${l.code}">${l.flag} ${l.name} (${l.code})</option>`)
        .join('');
      els.select.addEventListener('change', e => setLanguage(e.target.value));
    }

    // Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° json Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ
    async function setLanguage(code){
      try{
        const res = await fetch(`../lang/${code}.json`);
        if(!res.ok) throw new Error('Lang file not found: ' + code);
        const dict = await res.json();

        // dir / rtl
        const isRTL = !!dict?.language?.rtl;
        document.documentElement.setAttribute('dir', isRTL ? 'rtl' : 'ltr');
        els.rtlInfo.textContent = 'dir: ' + (isRTL ? 'rtl' : 'ltr');

        // Ð¿Ñ€Ð¾ÑÑ‚Ð°Ñ i18n: Ð²ÑÐµ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ñ data-i18n Ð·Ð°Ð¼ÐµÐ½ÑÐµÐ¼ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡Ñƒ
        document.querySelectorAll('[data-i18n]').forEach(node => {
          const key = node.getAttribute('data-i18n');
          const text = getByPath(dict, key) || node.textContent;
          node.textContent = text;
        });

        // Ð²Ñ‹Ð´ÐµÐ»Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½ÑƒÑŽ ÐºÐ½Ð¾Ð¿ÐºÑƒ + ÑÐµÐ»ÐµÐºÑ‚
        document.querySelectorAll('.lang-btn').forEach(b => {
          b.classList.toggle('active', b.dataset.code === code);
        });
        els.select.value = code;

        // ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ð¾Ñ€
        localStorage.setItem('ra_lang', code);

        // ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð¸Ñ‚ÑŒ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ
        window.dispatchEvent(new CustomEvent('languageChanged', { detail:{ code, dict } }));
      }catch(err){
        console.error(err);
        alert('Language load error: ' + err.message);
      }
    }

    // ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ð° Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð²Ð»Ð¾Ð¶ÐµÐ½Ð½Ñ‹Ð¼ ÐºÐ»ÑŽÑ‡Ð°Ð¼: "menu.language" â†’ dict.menu.language
    function getByPath(obj, path){
      return path.split('.').reduce((o,k)=> (o && k in o)? o[k] : undefined, obj);
    }

    // init
    buildUI();
    setLanguage(DEFAULT_CODE);
  </script>
</body>
</html>