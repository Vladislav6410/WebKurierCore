<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="WebKurier: —Ç–µ—Ä–º–∏–Ω–∞–ª, –∫–æ—à–µ–ª—ë–∫, –æ—Ñ–ª–∞–π–Ω-–¥–æ—Å—Ç—É–ø">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <style>
    /* ...–≤–µ—Å—å –≤–∞—à CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π... */
    #tools-panel {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #fff;
      color: #222;
      border-radius: 12px;
      box-shadow: 0 6px 32px rgba(0,0,0,0.25);
      z-index: 10010;
      padding: 32px 24px 24px 24px;
      min-width: 340px;
      max-width: 90vw;
      min-height: 320px;
      max-height: 90vh;
      overflow: auto;
    }
    body.dark-theme #tools-panel {
      background: #222;
      color: #f4f4f4;
    }
    #tools-panel textarea, #tools-panel select, #tools-panel input[type="text"] {
      width: 100%;
      min-height: 40px;
      font-family: monospace;
      font-size: 15px;
      margin: 12px 0;
      border-radius: 8px;
      border: 1px solid #aaa;
      padding: 8px;
      background: #fafafa;
      color: #222;
      resize: vertical;
    }
    body.dark-theme #tools-panel textarea,
    body.dark-theme #tools-panel select,
    body.dark-theme #tools-panel input[type="text"] {
      background: #181818;
      color: #f4f4f4;
      border: 1px solid #555;
    }
    #tools-panel .panel-buttons {
      text-align: right;
      margin-top: 10px;
    }
    #tools-panel .panel-buttons button {
      margin-left: 8px;
      padding: 7px 16px;
      border-radius: 6px;
      border: none;
      background: #06c;
      color: white;
      font-size: 14px;
      cursor: pointer;
    }
    #tools-panel .panel-buttons button:hover {
      background: #0057a6;
    }
    #tools-panel input[type="file"] {
      display: none;
    }
    #tools-panel label {
      display: inline-block;
      margin-bottom: 8px;
      cursor: pointer;
      color: #06c;
      text-decoration: underline;
    }
    #tools-panel .close-btn {
      position: absolute;
      top: 8px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 22px;
      color: #888;
      cursor: pointer;
    }
    #tools-panel .close-btn:hover {
      color: #c00;
    }
  </style>
</head>
<body>
  <div id="preloader"><div class="loader"></div></div>

  <button class="toggle-theme" onclick="toggleTheme()">–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button>

  <h1>üåê WebKurierCore</h1>
  <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å WebKurier: —Ç–µ—Ä–º–∏–Ω–∞–ª, –∫–æ—à–µ–ª—ë–∫, Telegram-—Å–≤—è–∑—å.</p>

  <!-- –ö–æ—à–µ–ª—ë–∫ -->
  <div class="wallet">
    <h2>üí∞ WebCoin-–∫–æ—à–µ–ª—ë–∫</h2>
    <div class="balance" id="webcoin-balance">–ë–∞–ª–∞–Ω—Å: 0 WKC</div>
    <button onclick="addCoins(10)">+10 WKC</button>
    <button onclick="resetCoins()">–°–±—Ä–æ—Å</button>
  </div>

  <!-- –¢–µ—Ä–º–∏–Ω–∞–ª -->
  <div class="terminal">
    <div>> WebKurier Terminal v1.0</div>
    <input type="text" id="terminal-input" placeholder="–í–≤–µ–¥–∏ –∫–æ–º–∞–Ω–¥—É...">
    <div id="terminal-log"></div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ -->
  <div class="terminal-buttons">
    <button onclick="runTerminalCommand()">‚èé –ü—É—Å–∫</button>
    <button onclick="openFilePicker()">üìÅ –§–∞–π–ª—ã</button>
    <button id="toolsButton">üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</button>
    <button onclick="copyTerminalInput()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <!-- Telegram -->
  <h2>üîó Telegram</h2>
  <p><a href="https://t.me/WebKurierBot" target="_blank">@WebKurierBot</a></p>

  <!-- DreamMaker UI (–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –∫–∞–∫ –µ—Å—Ç—å) -->
  <div id="screen"></div>
  <div id="preview-area"></div>
  <div id="chat"></div>
  <div class="chat-toolbar">
    <button id="btn-photo">üì∑</button>
    <button id="btn-video">üéû</button>
    <button id="btn-audio">üéµ</button>
    <textarea id="chat-input" placeholder="–°–∫–∞–∂–∏ –∏–ª–∏ –Ω–∞–ø–∏—à–∏‚Ä¶"></textarea>
    <button id="mic-btn">üé§</button>
    <button id="send-btn">‚û§</button>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
  <div id="tools-panel">
    <button class="close-btn" onclick="closeToolsPanel()">√ó</button>
    <h2>üõ† –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
    <div>
      <label for="htmlFile">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å .html —Ñ–∞–π–ª</label>
      <input type="file" id="htmlFile" accept=".html,.htm">
    </div>
    <textarea id="htmlEditor" placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–≤–æ—ë..."></textarea>
    <div>
      <label for="blockTemplates">üì¶ –®–∞–±–ª–æ–Ω—ã –±–ª–æ–∫–æ–≤</label>
      <select id="blockTemplates">
        <option value="">–í—ã–±–µ—Ä–∏ —à–∞–±–ª–æ–Ω...</option>
        <option value="<header><h1>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1></header>">–®–∞–ø–∫–∞</option>
        <option value="<footer><p>–§—É—Ç–µ—Ä</p></footer>">–§—É—Ç–µ—Ä</option>
        <option value="<section><h2>–ë–ª–æ–∫</h2><p>–¢–µ–∫—Å—Ç –±–ª–æ–∫–∞...</p></section>">–°–µ–∫—Ü–∏—è</option>
      </select>
      <button onclick="insertBlockTemplate()">–í—Å—Ç–∞–≤–∏—Ç—å</button>
    </div>
    <div>
      <label for="htmlDescInput">üß† –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</label>
      <input type="text" id="htmlDescInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: '–ö–Ω–æ–ø–∫–∞ —Å –Ω–∞–¥–ø–∏—Å—å—é –û—Ç–ø—Ä–∞–≤–∏—Ç—å'">
      <button onclick="generateHtmlFromDesc()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>
    <div class="panel-buttons">
      <button onclick="saveHtmlFile()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button onclick="exportZip()">üì¶ –≠–∫—Å–ø–æ—Ä—Ç ZIP</button>
      <button onclick="closeToolsPanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <!-- –°–∫—Ä–∏–ø—Ç—ã: –≤–Ω–µ—à–Ω–∏–µ –∏ –º–æ–¥—É–ª–∏ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="wallet.js"></script>
  <script src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js"></script>
  <script src="engine/dropbox.js"></script>
  <script src="engine/engineer.js"></script>
  <script src="engine/dream.js"></script>
  <script type="module" src="engine/agents/terminal/terminal-v2.js"></script>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤ -->
  <script type="module">
    import * as toolsAgent from './engine/agents/tools-agent.js';
    import { renderToolsPanel } from './engine/agents/tools-ui.js';
    window.toolsAgent = toolsAgent;
    renderToolsPanel();
    document.getElementById("toolsButton").addEventListener("click", () => {
      toolsAgent.showToolsPanel();
    });
  </script>
  <!-- JS –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π -->
  <script>
    // --- –¢–µ–º–∞ ---
    function toggleTheme() {
      document.body.classList.toggle('dark-theme');
      localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
    }

    // --- –ö–æ—à–µ–ª—ë–∫ ---
    function addCoins(amount) {
      let current = parseInt(localStorage.getItem('webcoin') || '0', 10);
      current += amount;
      localStorage.setItem('webcoin', current);
      document.getElementById('webcoin-balance').textContent = `–ë–∞–ª–∞–Ω—Å: ${current} WKC`;
    }
    function resetCoins() {
      localStorage.setItem('webcoin', '0');
      document.getElementById('webcoin-balance').textContent = `–ë–∞–ª–∞–Ω—Å: 0 WKC`;
    }

    // --- –¢–µ—Ä–º–∏–Ω–∞–ª ---
    function runTerminalCommand() {
      const e = new KeyboardEvent('keydown', { key: 'Enter' });
      document.getElementById('terminal-input').dispatchEvent(e);
    }
    function openFilePicker() {
      const inp = document.createElement('input');
      inp.type = 'file';
      inp.click();
    }
    function copyTerminalInput() {
      const input = document.getElementById('terminal-input');
      navigator.clipboard.writeText(input.value);
    }

    // --- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ---
    function openToolsPanel() {
      document.getElementById('tools-panel').style.display = 'block';
    }
    function closeToolsPanel() {
      document.getElementById('tools-panel').style.display = 'none';
      document.getElementById('htmlFile').value = '';
    }
    // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –º–æ–¥—É–ª—è–º–∏
    if (document.getElementById('toolsButton')) {
      document.getElementById('toolsButton').onclick = openToolsPanel;
    }

    // --- –ó–∞–≥—Ä—É–∑–∫–∞ .html —Ñ–∞–π–ª–∞ ---
    document.getElementById('htmlFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById('htmlEditor').value = ev.target.result;
      };
      reader.readAsText(file, 'UTF-8');
    });

    // --- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ .html —Ñ–∞–π–ª–∞ ---
    function saveHtmlFile() {
      const content = document.getElementById('htmlEditor').value;
      const blob = new Blob([content], {type: 'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'result.html';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }

    // --- –í—Å—Ç–∞–≤–∫–∞ —à–∞–±–ª–æ–Ω–∞ –±–ª–æ–∫–∞ ---
    function insertBlockTemplate() {
      const select = document.getElementById('blockTemplates');
      const value = select.value;
      if (value) {
        const editor = document.getElementById('htmlEditor');
        editor.value += '\n' + value;
      }
    }

    // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é ---
    function generateHtmlFromDesc() {
      const desc = document.getElementById('htmlDescInput').value.trim().toLowerCase();
      let html = '';
      if (desc.includes('–∫–Ω–æ–ø–∫–∞')) {
        const match = desc.match(/–∫–Ω–æ–ø–∫–∞ —Å –Ω–∞–¥–ø–∏—Å—å—é (.+)/);
        html = `<button>${match ? match[1] : '–ö–Ω–æ–ø–∫–∞'}</button>`;
      } else if (desc.includes('–∑–∞–≥–æ–ª–æ–≤–æ–∫')) {
        html = `<h1>–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1>`;
      } else if (desc.includes('—Å–ø–∏—Å–æ–∫')) {
        html = `<ul><li>–ü—É–Ω–∫—Ç 1</li><li>–ü—É–Ω–∫—Ç 2</li></ul>`;
      } else {
        html = '<!-- –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ -->';
      }
      document.getElementById('htmlEditor').value += '\n' + html;
    }

    // --- –≠–∫—Å–ø–æ—Ä—Ç ZIP ---
    function exportZip() {
      const html = document.getElementById('htmlEditor').value;
      if (!window.JSZip) {
        const script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
        script.onload = exportZip;
        document.body.appendChild(script);
        return;
      }
      const zip = new JSZip();
      zip.file("index.html", html);
      zip.generateAsync({type:"blob"}).then(function(content) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(content);
        a.download = "project.zip";
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          document.body.removeChild(a);
          URL.revokeObjectURL(a.href);
        }, 0);
      });
    }

    // --- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä –∏ —Ç–µ–º–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ ---
    window.addEventListener('load', () => {
      document.getElementById('preloader').style.opacity = '0';
      setTimeout(() => {
        document.getElementById('preloader').style.display = 'none';
        document.getElementById('terminal-input').focus();
      }, 400);

      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
      }
      const coins = parseInt(localStorage.getItem('webcoin') || '0', 10);
      document.getElementById('webcoin-balance').textContent = `–ë–∞–ª–∞–Ω—Å: ${coins} WKC`;
    });
  </script>
</body>
</html>
