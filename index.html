<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>WebKurierCore ¬∑ –ü–æ—Ä—Ç–∞–ª –∞–≥–µ–Ω—Ç–æ–≤</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg-light:#f4f4f4;
      --bg-dark:#020617;
      --text-light:#1a1a1a;
      --text-dark:#e5e7eb;
      --link-light:#007acc;
      --link-dark:#60a5fa;
      --accent-light:#3b82f6;
      --accent-dark:#2563eb;

      --card-bg:#020617;
      --card-border:#1f2937;
      --btn-border:#374151;
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      padding:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:radial-gradient(circle at top,#111827 0,#020617 55%);
      color:var(--text-dark);
      transition:background-color .3s,color .3s;
    }

    body.light-theme{
      background:var(--bg-light);
      color:var(--text-light);
    }

    a{ color:var(--link-dark); text-decoration:none; }
    body.light-theme a{ color:var(--link-light); }

    .page{
      max-width:1120px;
      margin:0 auto;
      padding:24px 16px 40px;
    }

    header{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:24px;
    }

    .title{
      font-size:2rem;
      font-weight:700;
    }

    .subtitle{
      color:#9ca3af;
      font-size:.95rem;
      max-width:720px;
    }

    .top-actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }

    .btn{
      padding:9px 14px;
      font-size:.9rem;
      border-radius:999px;
      border:1px solid var(--btn-border);
      background:rgba(15,23,42,.95);
      color:var(--text-dark);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .btn:hover{ border-color:var(--accent-dark); }

    body.light-theme .btn{
      background:#fff;
      color:#111827;
    }

    .section-title{
      margin-top:26px;
      margin-bottom:10px;
      font-size:1.2rem;
      font-weight:600;
    }

    .agents-menu{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;
      margin-top:12px;
    }

    .agent-group-card{
      border:1px solid var(--card-border);
      border-radius:12px;
      padding:12px 14px;
      background:linear-gradient(145deg,#020617,#020617 55%,#0b1120);
      box-shadow:0 14px 32px rgba(0,0,0,.55);
    }

    body.light-theme .agent-group-card{
      background:#fff;
      box-shadow:0 8px 20px rgba(15,23,42,.10);
    }

    .agent-group-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:6px;
    }

    .agent-group-left{
      display:flex;
      align-items:center;
      gap:6px;
    }

    .agent-group-title{
      font-weight:600;
      font-size:1.02rem;
    }

    .agent-group-icon{ font-size:1.4rem; }

    .agent-access-badge{
      font-size:.72rem;
      text-transform:uppercase;
      opacity:.7;
    }

    .agent-group-agents{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:6px;
    }

    .agent-chip{
      padding:4px 9px;
      border-radius:999px;
      font-size:.8rem;
      border:1px solid #4b5563;
      cursor:pointer;
      white-space:nowrap;
      background:rgba(15,23,42,.9);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .agent-chip span.agent-icon{ font-size:1rem; }

    .agent-chip:hover{ border-color:var(--accent-dark); }

    body.light-theme .agent-chip{
      background:#f9fafb;
      border-color:#d1d5db;
    }

    .agent-chip.disabled{
      opacity:.4;
      cursor:default;
    }

    .toggle-theme{
      position:fixed;
      top:12px;
      right:12px;
      z-index:1000;
      padding:7px 13px;
      border-radius:999px;
      background-color:var(--accent-dark);
      color:#fff;
      border:none;
      cursor:pointer;
      font-size:.85rem;
    }
    body.light-theme .toggle-theme{ background-color:var(--accent-light); }

    #preloader{
      position:fixed;
      inset:0;
      background:#020617;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:999;
      transition:opacity .4s;
    }

    body.light-theme #preloader{ background:#f4f4f4; }

    .loader{
      width:38px;
      height:38px;
      border-radius:50%;
      border:4px solid #4b5563;
      border-top-color:#facc15;
      animation:spin .9s linear infinite;
    }

    @keyframes spin{ to{ transform:rotate(360deg); } }

    @media (max-width:640px){
      header{ padding-top:18px; }
      .title{ font-size:1.6rem; }
    }

    /* --- Mini Codex Remote (Home) --- */
    .codex-mini{
      margin-top:12px;
      border:1px solid var(--card-border);
      border-radius:12px;
      padding:12px;
      background:linear-gradient(145deg,#0b1120,#0f172a);
    }
    body.light-theme .codex-mini{
      background:#fff;
      border-color:#d1d5db;
    }

    .codex-mini .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }

    .codex-mini label{
      display:block;
      font-size:.82rem;
      opacity:.85;
      margin-bottom:6px;
    }

    .codex-mini select,
    .codex-mini textarea{
      width:100%;
      border:1px solid #243047;
      background:rgba(2,6,23,.35);
      color:inherit;
      border-radius:12px;
      padding:10px;
      outline:none;
    }
    body.light-theme .codex-mini select,
    body.light-theme .codex-mini textarea{
      background:#f9fafb;
      border-color:#d1d5db;
    }

    .codex-mini textarea{
      min-height:92px;
      resize:vertical;
      line-height:1.35;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size:.9rem;
    }

    .codex-mini .status{
      margin-top:10px;
      border:1px solid #243047;
      border-radius:12px;
      background:rgba(2,6,23,.35);
      padding:10px;
      white-space:pre-wrap;
      word-break:break-word;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      font-size:.9rem;
      opacity:.95;
    }
    .codex-mini .status.ok{ border-color:rgba(52,211,153,.35); }
    .codex-mini .status.bad{ border-color:rgba(251,113,133,.45); }

    .codex-mini .mini-btn{
      padding:9px 12px;
      border-radius:999px;
      border:1px solid var(--btn-border);
      background:rgba(15,23,42,.95);
      color:inherit;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      font-size:.9rem;
      text-decoration:none;
    }
    .codex-mini .mini-btn:hover{ border-color:var(--accent-dark); }
    body.light-theme .codex-mini .mini-btn{
      background:#fff;
      color:#111827;
    }
  </style>
</head>

<body>
  <button class="toggle-theme" id="themeToggle">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</button>
  <div id="preloader"><div class="loader"></div></div>

  <div class="page">
    <header>
      <div class="title">WebKurierCore ¬∑ –ü–æ—Ä—Ç–∞–ª –∞–≥–µ–Ω—Ç–æ–≤</div>
      <p class="subtitle">
        –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –≤—Ö–æ–¥ –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É WebKurier. –ó–¥–µ—Å—å –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –∞–≥–µ–Ω—Ç—ã, Dev-–∫–æ–º–∞–Ω–¥–∞ –∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.
        –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —É–ø—Ä–∞–≤–ª—è–µ—Ç WebKurierHybrid, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ WebKurierCore.
      </p>

      <div class="top-actions">
        <a class="btn" href="engine/agents/dev-team/dev-team-core.html">üõ† Dev &amp; Build Team</a>
        <a class="btn" href="admin/terminal.html">‚å®Ô∏è Admin Terminal</a>
        <a class="btn" href="admin/logs.html">üìú Admin Logs</a>
        <a class="btn" href="admin/status.html">üìä System Status</a>

        <!-- ‚úÖ Codex Console (–∫–Ω–æ–ø–∫–∞ –≤ –º–µ–Ω—é) -->
        <a class="btn" href="/admin/codex.html">üß† Codex Console</a>
      </div>

      <!-- ‚úÖ Mini Codex Remote (Home) -->
      <div class="codex-mini" id="codexMini">
        <div class="row">
          <a class="mini-btn" href="/admin/codex.html">üß† Codex Console</a>
          <a class="mini-btn" href="/admin/terminal.html">‚å®Ô∏è Terminal</a>
          <a class="mini-btn" href="/admin/logs.html">üìú Logs</a>
          <a class="mini-btn" href="/admin/status.html">üìä Status</a>

          <button class="mini-btn" id="btnHealthMini">‚úÖ /health</button>
        </div>

        <div class="row" style="margin-top:10px; width:100%;">
          <div style="flex:1; min-width:240px;">
            <label>–ì–æ—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ (–ø–∞–∫–µ—Ç—ã)</label>
            <select id="codexPackMini">
              <option value="">‚Äî –≤—ã–±—Ä–∞—Ç—å ‚Äî</option>
              <option value="ping">[0] ping / smoke-test</option>
              <option value="scan_repo">[1] –ü—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Codex</option>
              <option value="add_codex_buttons">[2] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–Ω–æ–ø–∫–∏ Codex –Ω–∞ –≥–ª–∞–≤–Ω–æ–π</option>
              <option value="security_audit">[3] Security-gates + Chain-audit check</option>
              <option value="bugs_find">[4] –ù–∞–π—Ç–∏ –±–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏ /admin/*</option>
              <option value="report_status">[5] –ö–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç ‚Äú—á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ / —á—Ç–æ –¥–∞–ª—å—à–µ‚Äù</option>
            </select>
          </div>

          <div style="width:190px; min-width:190px;">
            <label>Reasoning</label>
            <select id="codexReasonMini">
              <option value="low">low</option>
              <option value="medium" selected>medium</option>
              <option value="high">high</option>
              <option value="xhigh">xhigh</option>
            </select>
          </div>

          <div style="width:220px; min-width:220px;">
            <label>–î–µ–π—Å—Ç–≤–∏—è</label>
            <div class="row">
              <button class="mini-btn" id="btnInsertPackMini">üì¶ –í—Å—Ç–∞–≤–∏—Ç—å</button>
              <button class="mini-btn" id="btnRunCodexMini">‚ñ∂ Run</button>
              <button class="mini-btn" id="btnClearCodexMini">üßΩ –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
          </div>
        </div>

        <div style="margin-top:10px;">
          <label>taskText (–º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)</label>
          <textarea id="codexTaskMini" placeholder="–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç ‚Üí –í—Å—Ç–∞–≤–∏—Ç—å ‚Üí Run (–∏–ª–∏ –Ω–∞–ø–∏—à–∏ —Å–≤–æ—é –∑–∞–¥–∞—á—É)"></textarea>
        </div>

        <div class="status" id="codexMiniOut">–ì–æ—Ç–æ–≤–æ. –ù–∞–∂–º–∏ ‚úÖ /health –∏–ª–∏ –≤—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç ‚Üí Run.</div>
      </div>
    </header>

    <section>
      <h2 class="section-title">–ê–≥–µ–Ω—Ç—ã –∏ –º–æ–¥—É–ª–∏</h2>
      <p class="subtitle" style="margin-bottom:6px;">
        –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∏ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ <code>engine/config/agents_map.json</code>.
        –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∏–ø –∞–≥–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –µ–≥–æ HTML-—è–¥—Ä–æ.
      </p>

      <div id="agents-menu" class="agents-menu">
        <!-- —Å—é–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –º–µ–Ω—é –∞–≥–µ–Ω—Ç–æ–≤ –∏–∑ agents-menu.js -->
      </div>
    </section>

    <section>
      <h2 class="section-title">–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º</h2>
      <p class="subtitle">
        –£—Ä–æ–≤–µ–Ω—å 0‚Äì2: WebKurierHybrid (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä), WebKurierCore (—è–¥—Ä–æ), DroneHybrid, Chain,
        Security, PhoneCore. –£—Ä–æ–≤–µ–Ω—å 3‚Äì4: –º–æ–±–∏–ª—å–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø—É–±–ª–∏—á–Ω—ã–π —Å–∞–π—Ç WebKurierSite.
        –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ö–µ–º–∞ ‚Äî –≤ <code>docs/ARCHITECTURE.md</code> –∏ <code>docs/REPOS_MAP.md</code>.
      </p>
    </section>
  </div>

  <script src="engine/ui/agents-menu.js"></script>
  <script>
    const THEME_KEY = 'wk-theme';

    function applyTheme(theme) {
      const btn = document.getElementById('themeToggle');
      if (theme === 'light') {
        document.body.classList.add('light-theme');
        btn.textContent = '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
      } else {
        document.body.classList.remove('light-theme');
        btn.textContent = '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞';
      }
    }

    document.getElementById('themeToggle').addEventListener('click', () => {
      const current = localStorage.getItem(THEME_KEY) || 'dark';
      const next = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem(THEME_KEY, next);
      applyTheme(next);
    });

    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem(THEME_KEY) || 'dark';
      applyTheme(saved);

      const pre = document.getElementById('preloader');
      setTimeout(() => {
        pre.style.opacity = '0';
        setTimeout(() => (pre.style.display = 'none'), 400);
      }, 200);

      if (window.AgentsMenu && typeof window.AgentsMenu.init === 'function') {
        window.AgentsMenu.init({
          containerId: 'agents-menu',
          lang: 'ru',
          configPath: 'engine/config/agents_map.json'
        });
      }
    });
  </script>

  <script>
    // --- Mini Codex Remote (Home) ---
    (function () {
      const packs = {
        ping: "ping",
        scan_repo: [
          "–ü—Ä–æ—Å–∫–∞–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —Å–∫–∞–∂–∏:",
          "1) –≥–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω /api/codex/run –∏ –≥–¥–µ –æ–Ω –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ server",
          "2) –≥–¥–µ –ª–µ–∂–∏—Ç UI Codex Console –∏ –∫–∞–∫ –æ–Ω –ø–æ–¥—Ü–µ–ø–ª–µ–Ω",
          "3) 3 —Å–ª–µ–¥—É—é—â–∏—Ö –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏—è",
        ].join("\n"),
        add_codex_buttons: [
          "–ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –µ—Å—Ç—å –º–∏–Ω–∏-–ø—É–ª—å—Ç Codex –∏ –∫–Ω–æ–ø–∫–∞ Codex Console.",
          "–ï—Å–ª–∏ —á–µ–≥–æ-—Ç–æ –Ω–µ—Ç ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–∞—Ç—á.",
        ].join("\n"),
        security_audit: [
          "–ü—Ä–æ–≤–µ—Ä—å security-gates –∏ chain-audit:",
          "1) allowlist/denylist",
          "2) –∫—É–¥–∞ –ø–∏—à–µ—Ç—Å—è auditEvent",
          "3) —á—Ç–æ —É–ª—É—á—à–∏—Ç—å –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –æ–± –æ—Ç–∫–∞–∑–µ security gate",
        ].join("\n"),
        bugs_find: [
          "–ù–∞–π–¥–∏ –æ—à–∏–±–∫–∏:",
          "1) –±–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏ /admin/*",
          "2) –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–µ–π frontend/static",
          "3) —á—Ç–æ –º–æ–∂–µ—Ç –ª–æ–º–∞—Ç—å /api/codex/run",
        ].join("\n"),
        report_status: [
          "–°–¥–µ–ª–∞–π –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç—á—ë—Ç:",
          "- —á—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ Codex",
          "- —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä—É–∫–∞–º–∏",
          "- 3 —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞ (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–µ).",
        ].join("\n"),
      };

      const outEl = document.getElementById("codexMiniOut");
      const taskEl = document.getElementById("codexTaskMini");
      const packEl = document.getElementById("codexPackMini");
      const reasonEl = document.getElementById("codexReasonMini");

      function setOut(text, ok=true){
        outEl.textContent = text || "‚Äî";
        outEl.classList.remove("ok","bad");
        outEl.classList.add(ok ? "ok" : "bad");
      }

      async function checkHealth(){
        setOut("–ü—Ä–æ–≤–µ—Ä—è—é /health ...");
        try{
          const res = await fetch("/health");
          const data = await res.json().catch(() => ({}));
          if(!res.ok || !data.ok) throw new Error("health not ok");
          setOut("Health OK ‚úÖ  " + JSON.stringify(data));
        }catch(e){
          setOut("Health FAIL: " + (e.message || e), false);
        }
      }

      async function runCodex(){
        const taskText = (taskEl.value || "").trim();
        if(!taskText){
          setOut("–í—Å—Ç–∞–≤—å –∑–∞–¥–∞—á—É: –≤—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç ‚Üí –í—Å—Ç–∞–≤–∏—Ç—å ‚Üí Run.", false);
          return;
        }
        const reasoning = reasonEl.value || "medium";
        const sessionId = localStorage.getItem("wk-codex-session") || ("wk_" + Date.now());
        localStorage.setItem("wk-codex-session", sessionId);

        setOut("–û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–¥–∞—á—É –≤ /api/codex/run ...");
        try{
          const res = await fetch("/api/codex/run", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ taskText, reasoning, sessionId })
          });
          const data = await res.json().catch(() => ({}));
          if(!res.ok || !data.ok) throw new Error(data.error || ("HTTP " + res.status));
          setOut(data.output_text || "(–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç)", true);
        }catch(e){
          setOut("–û—à–∏–±–∫–∞ Codex: " + (e.message || e), false);
        }
      }

      function insertPack(){
        const k = packEl.value;
        if(!k){ setOut("–í—ã–±–µ—Ä–∏ –ø–∞–∫–µ—Ç –≤ —Å–ø–∏—Å–∫–µ.", false); return; }
        taskEl.value = packs[k] || "";
        setOut("–ü–∞–∫–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω: " + k);
      }

      function clearAll(){
        taskEl.value = "";
        setOut("–û—á–∏—â–µ–Ω–æ.");
      }

      document.getElementById("btnHealthMini")?.addEventListener("click", checkHealth);
      document.getElementById("btnInsertPackMini")?.addEventListener("click", insertPack);
      document.getElementById("btnRunCodexMini")?.addEventListener("click", runCodex);
      document.getElementById("btnClearCodexMini")?.addEventListener("click", clearAll);
    })();
  </script>

  <!-- ‚úÖ –í—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (accountant bridge) -->
  <script src="engine/agents/accountant/web/fop-cabinet-bridge.js"></script>
</body>
</html>