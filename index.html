<!DOCTYPE html>
<html lang="ru">
<head>
  <!-- ...остальная часть head... -->
</head>
<body>
  <!-- ...существующий контент... -->

  <!-- 📊 Таблица прайсов на аэрофотосъёмку -->
  <section id="drone-prices">
    <h2>📊 Прайс на аэрофотосъёмку (1 км²)</h2>
    <table border="1" cellpadding="8" cellspacing="0" style="border-collapse: collapse; width: 100%; font-family: sans-serif;">
      <thead style="background: #f0f0f0;">
        <tr>
          <th>№</th>
          <th>Пакет</th>
          <th>Описание</th>
          <th>Цена</th>
          <th>Срок</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td><b>Base Map</b></td>
          <td>Ортофото (GeoTIFF, JPG), PDF-карта, выравнивание, базовая обработка</td>
          <td><b>390 €</b></td>
          <td>1–2 дня</td>
        </tr>
        <tr>
          <td>2</td>
          <td><b>3D Terrain</b></td>
          <td>DSM/DTM, 3D-модель (.OBJ, .PLY, .LAS), облако точек, точная геопривязка</td>
          <td><b>790 €</b></td>
          <td>2–3 дня</td>
        </tr>
        <tr>
          <td>3</td>
          <td><b>GeoAnalysis</b></td>
          <td>NDVI/NDRE, растровый анализ, отчёт в PDF, контуры объектов, классификация</td>
          <td><b>1290 €</b></td>
          <td>3–5 дней</td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- 🐍 Код Python для генерации геоотчётов -->
  <section id="python-code" style="margin-top: 40px; background: #f8f8f8; padding: 20px; border-radius: 10px;">
    <h2>📁 Код генератора геоотчёта (Python)</h2>
    <pre style="background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; overflow-x: auto; font-family: 'Courier New', monospace;">
import os
import json
from fpdf import FPDF
from datetime import datetime

# 📌 Путь к сохранённым данным съёмки и анализов
DATA_DIR = "./engine/logs/reports/"
OUTPUT_DIR = "./engine/logs/generated/"

class GeoReport:
    def __init__(self, mission_name):
        self.mission_name = mission_name
        self.report_data = {}
        self.date = datetime.now().strftime("%Y-%m-%d %H:%M")

    def load_data(self):
        file_path = os.path.join(DATA_DIR, f"{self.mission_name}.json")
        if not os.path.exists(file_path):
            raise FileNotFoundError(f"Нет данных для отчёта: {file_path}")
        with open(file_path, 'r', encoding='utf-8') as f:
            self.report_data = json.load(f)

    def generate_pdf(self):
        pdf = FPDF()
        pdf.add_page()
        pdf.set_font("Arial", "B", 14)

        # Заголовок
        pdf.cell(0, 10, f"📍 Геоотчёт: {self.mission_name}", ln=True)
        pdf.set_font("Arial", "", 12)
        pdf.cell(0, 10, f"Дата генерации: {self.date}", ln=True)

        # 📊 Основные параметры
        pdf.ln(10)
        for key, value in self.report_data.items():
            if isinstance(value, dict):
                pdf.set_font("Arial", "B", 12)
                pdf.cell(0, 10, f"🔹 {key}", ln=True)
                pdf.set_font("Arial", "", 12)
                for subkey, subvalue in value.items():
                    pdf.cell(0, 10, f"  • {subkey}: {subvalue}", ln=True)
            else:
                pdf.cell(0, 10, f"{key}: {value}", ln=True)

        # Сохранение
        os.makedirs(OUTPUT_DIR, exist_ok=True)
        output_path = os.path.join(OUTPUT_DIR, f"{self.mission_name}_report.pdf")
        pdf.output(output_path)
        return output_path


# 🧪 Пример использования:
if __name__ == "__main__":
    report = GeoReport("test_mission_01")
    report.load_data()
    path = report.generate_pdf()
    print(f"✅ Отчёт сохранён: {path}")</pre>
    
    <div style="margin-top: 20px; background: #e6f7ff; padding: 15px; border-radius: 8px; border-left: 4px solid #1890ff;">
      <h3>🔧 Где размещать:</h3>
      <ul>
        <li><code>report_generator.py</code> → в папку Webkuriercore/ рядом с main.py</li>
        <li>Данные в формате JSON → <code>engine/logs/reports/</code></li>
        <li>PDF-файлы отчётов → <code>engine/logs/generated/</code></li>
      </ul>
      
      <h3>📂 Пример входного файла:</h3>
      <pre style="background: #fff; padding: 15px; border-radius: 8px; border: 1px solid #ddd;">
{
  "Участок": "Полевой массив 3A",
  "GSD": "3.5 см/пиксель",
  "Высота полета": "120 м",
  "Камера": "Sony RX1RM2",
  "Количество снимков": 198,
  "Размер области": "12.5 га",
  "Перекрытие": {
    "Продольное": "80%",
    "Поперечное": "70%"
  },
  "Результаты": {
    "Ортофотоплан": "Сформирован",
    "ЦМР": "Готова",
    "3D-сцена": "Экспортирована в OBJ"
  }
}</pre>
    </div>
  </section>

  <!-- 📂 Структура папок проекта -->
  <section id="folder-structure" style="margin-top: 40px;">
    <h2>📂 Структура папок проекта</h2>
    <div style="background: #f0f8ff; padding: 20px; border-radius: 10px; font-family: 'Courier New', monospace; line-height: 1.6;">
      engine/<br>
      ├── agents/<br>
      │   ├── geodesist/<br>
      │   │   ├── report/                  &larr; Генерация PDF, GeoTIFF, NDVI<br>
      │   │   ├── ui/                      &larr; Интерфейс кнопок /отчёт, /цены<br>
      │   │   └── templates/               &larr; HTML, PDF шаблоны отчётов<br>
      │   ├── autopilot/                   &larr; Агент автопилота дрона<br>
      │   ├── pilot/                       &larr; Агент ручного управления<br>
      │   ├── telemetry/                   &larr; Сбор телеметрии<br>
      │   ├── translator/                  &larr; Переводчик и локализация<br>
      │   ├── accountant/                  &larr; Финансовые отчёты и налоги<br>
      │   ├── security/                    &larr; Агент безопасности (антивирус, токены)<br>
      │   └── master/                      &larr; Главный управляющий<br>
      │<br>
      ├── config/<br>
      │   ├── settings.json                &larr; Глобальная конфигурация<br>
      │   ├── missions.json                &larr; Настройки полётов<br>
      │   └── report_config.json           &larr; Настройки отчётов<br>
      │<br>
      ├── logs/<br>
      │   ├── reports/                     &larr; Сырые JSON-данные полей<br>
      │   ├── generated/                   &larr; PDF, GeoTIFF, модели<br>
      │   └── telemetry/                   &larr; Данные полёта, датчики<br>
      │<br>
      ├── memory/<br>
      │   └── assistant_memory.json        &larr; Виртуальная память помощника<br>
      │<br>
      ├── prompts/<br>
      │   ├── geodesy.prompt.json          &larr; Шаблоны задач по геодезии<br>
      │   ├── report.prompt.json           &larr; Формулировки отчётов<br>
      │   └── ui.prompt.json               &larr; Тексты кнопок и интерфейса<br>
      │<br>
      ├── ui/<br>
      │   ├── index.html                   &larr; Интерфейс WebApp<br>
      │   ├── report-ui.html               &larr; Отдельная страница отчёта<br>
      │   ├── styles.css                   &larr; Стили<br>
      │   └── scripts/<br>
      │       ├── report.js                &larr; Кнопка /отчёт<br>
      │       ├── prices.js                &larr; Кнопка /цены<br>
      │       └── utils.js                 &larr; Общие функции<br>
      │<br>
      └── data/<br>
          ├── cameras.json                 &larr; Список камер и GSD<br>
          ├── price_list.csv               &larr; Прайс на 1 км²<br>
          └── missions/<br>
              └── mission1.json            &larr; Настройки миссий<br>
    </div>
  </section>

  <!-- ===== Панель агентов ===== -->
<div id="agents-panel" class="agents-panel"></div>

<style>
  /* ==== Стили панели агентов ==== */
  .agents-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
  }

  .agent-button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 14px;
    background: #0d6efd;      /* синий по умолчанию */
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s ease;
  }

  .agent-button:hover {
    background: #0b5ed7;      /* темнее при наведении */
  }

  .agent-button.disabled {
    background: #6c757d;      /* серый если агент выключен */
    cursor: not-allowed;
    opacity: 0.7;
  }
</style>

<script type="module">
  import { renderAgentButtons } from './engine/agents/loader.js';

  window.addEventListener('DOMContentLoaded', () => {
    const panel = document.getElementById('agents-panel');

    if (!panel) {
      console.warn('⚠️ Не найден элемент #agents-panel');
      return;
    }

    renderAgentButtons(panel, (key, meta, mod) => {
      // Когда нажали на кнопку — что-то делаем
      if (mod?.run) {
        mod.run({ meta, key });
      } else {
        console.log(`Агент "${meta.name}" загружен, но нет функции run()`, mod);
      }
    });
  });
</script>
</body>
</html>